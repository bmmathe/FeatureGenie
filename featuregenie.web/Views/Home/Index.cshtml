@model featuregenie.web.Models.HomeViewModel
@section scripts
{
    <script>
        $("#selectApplication").change(function() {
            var id = $("#selectApplication").val();
            $.post("/Home/_Features/" + id, function(data) {
                $("#features").html(data);
                bindFeatureButtons();
            });

            $.post("/Configuration/_ConfigurationSettings/" + id, function(data) {
                $("#configuration").html(data);
                bindConfigurationSettingButtons();
            });

            
        });

        $("#createApplicationModal").on("shown.bs.modal", function() {
            $("#ApplicationName").focus();
        });

        $("#saveApplicationButton").click(function() {
            $.ajax({
                type: "POST",
                url: "/Home/CreateApplication",
                data: $("#newApplicationForm").serialize(),
                success: function(features) {
                    $("#createApplicationModal").modal("hide");
                    $("#features").html(features);
                },
                error: function() {
                    $("#createApplicationModal").modal("hide");
                }
            });
        });

        $("#createFeatureModal").on("shown.bs.modal", function() {
            var selectedApplicationId = $("#selectApplication").val();
            $("#newFeatureForm > #ApplicationId").val(selectedApplicationId);
            $("#Name").focus();
        });

        $("#saveFeatureButton").click(function() {
            $.ajax({
                type: "POST",
                url: "/Home/CreateFeature",
                data: $("#newFeatureForm").serialize(),
                success: function(features) {
                    $("#createFeatureModal").modal("hide");
                    $("#features").html(features);
                    bindFeatureButtons();
                },
                error: function() {
                    $("#createFeatureModal").modal("hide");
                }
            });
        });

        $("#createConfigurationSettingModal").on("shown.bs.modal", function() {
            var selectedApplicationId = $("#selectApplication").val();
            $("#newConfigurationSettingForm > #ApplicationId").val(selectedApplicationId);
            $("#Name").focus();
        });

        $("#saveConfigurationSettingButton").click(function() {
            $.ajax({
                type: "POST",
                url: "/Configuration/Create",
                data: $("#newConfigurationSettingForm").serialize(),
                success: function(configuration) {
                    $("#createConfigurationSettingModal").modal("hide");
                    $("#configuration").html(configuration);
                    bindConfigurationSettingButtons();
                },
                error: function() {
                    $("#createConfiguationSettingModal").modal("hide");
                }
            });
        });

        var bindConfigurationSettingButtons = function () {
            $("a[data-action='edit-configuration-setting']").each(function (index) {
                var configurationId = $(this).data("configuration-id");                                   
                $(this).click(function () {
                    // show edit configuration settings modal
                    $("#createConfiguationSettingModal").modal("show");
                });                
            });

            $("a[data-action='delete-configuration-setting']").each(function (index) {
                var configurationId = $(this).data("configuration-id");
                $(this).click(function () {
                    $.ajax({
                        type: "GET",
                        url: "/Configuration/Delete/" + configurationId,
                        success: function (configuration) {
                            $("#configuration").html(configuration);
                            bindConfigurationSettingButtons();
                        }
                    });
                });              
            });
        }

        var bindFeatureButtons = function () {
            $("a[data-action='edit-feature']").each(function (index) {
                var featureId = $(this).data("feature-id");
                $(this).click(function () {
                    // show edit configuration settings modal
                    $("#createFeatureModal").modal("show");
                });
            });

            $("a[data-action='delete-feature']").each(function (index) {
                var featureId = $(this).data("feature-id");
                $(this).click(function () {
                    $.ajax({
                        type: "GET",
                        url: "/Feature/Delete/" + featureId,
                        success: function (features) {
                            $("#features").html(features);
                            bindFeatureButtons();
                        }
                    });
                });
            });
        }
    </script>
}

<div class="row" id="applications">
    @Html.Partial("_Applications", Model)
</div>

<ul class="nav nav-tabs" role="tablist">
    <li role="features" class="active"><a href="#features" aria-controls="home" role="tab" data-toggle="tab">Features</a></li>
    <li role="configuration"><a href="#configuration" aria-controls="home" role="tab" data-toggle="tab">Configuration</a></li>
</ul>
<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="features"></div>
    <div role="tabpanel" class="tab-pane" id="configuration"></div>
</div>

@Html.Partial("_CreateApplicationModal")
@Html.Partial("_CreateFeatureModal")
@Html.Partial("_CreateConfigurationSettingModal")